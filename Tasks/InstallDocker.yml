# Run with:
# ansible-playbook InstallDocker.yml

---
- name: Install Docker and Start Service
  hosts: all
# Created by running: ansible-vault encrypt_string <my secret here> --ask-vault-pass
  vars:
    dockerpass: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          61633264316361336664346561633434636332663863643064353730356431333163343030363830
          6333663261653261326431313433626137353239313761300a333233653633613336353037386663
          63356434303064623565366263383464373932653031636265373233626331663936336162386463
          3835386563613130370a653032336232393463303634363135326266633961313963373865613039
          30323937633066306132303833613361643632646632356665646131383539623731
  tasks:

  - name: Install just Docker package on OpenSUSE/SUSE Linux
    zypper:
      name: docker
      state: present

  - name: Install docker-compose package on OpenSUSE/SUSE Linux
    zypper:
      name: docker-compose
      state: present

#  - name: Install docker-compose Python package on OpenSUSE/SUSE Linux
#    zypper:
#      name: python311-docker-compose
#      state: present

  # Was needed for Docker Swarm
  - name: Install Python modules for docker package on OpenSUSE/SUSE Linux
    zypper:
      name: python*-docker
      state: present

  # Was needed for Docker Swarm Deploy
  - name: Install JSON Diff for docker package on OpenSUSE/SUSE Linux
    zypper:
      name: python*-jsondiff
      state: present

  - name: Install PIP on OpenSUSE/SUSE Linux
    zypper:
      name: python*-pip
      state: present

#  - name: Install Docker-Compose python package
#    ansible.builtin.pip:
#      name: docker-compose

  - name: Enable Docker service
    ansible.builtin.systemd:
      name: docker
      enabled: yes

  - name: Start Docker service
    ansible.builtin.systemd:
      state: restarted
      name: docker

  - name: Log into DockerHub
    community.docker.docker_login:
      username: ajorians
      password: "{{ dockerpass | string }}"

